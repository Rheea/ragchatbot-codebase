USER QUERY PROCESSING FLOW - DETAILED ASCII DIAGRAM
===================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    USER     â”‚                    â”‚                  FRONTEND                           â”‚
â”‚             â”‚                    â”‚                script.js                           â”‚
â”‚ Types query â”‚                    â”‚                                                     â”‚
â”‚ Clicks send â”‚                    â”‚  sendMessage() function                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â€¢ chatInput.value.trim()                         â”‚
       â”‚                           â”‚  â€¢ Disable input, show loading                    â”‚
       â”‚ "What is MCP?"            â”‚  â€¢ addMessage(query, 'user')                     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  â€¢ createLoadingMessage()                        â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                                                     â”‚ HTTP POST /api/query
                                                     â”‚ Content-Type: application/json
                                                     â”‚ Body: {
                                                     â”‚   "query": "What is MCP?",
                                                     â”‚   "session_id": "uuid-123" | null
                                                     â”‚ }
                                                     â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                FASTAPI BACKEND                      â”‚
                   â”‚                   app.py                           â”‚
                   â”‚                                                     â”‚
                   â”‚  @app.post("/api/query")                           â”‚
                   â”‚  async def query_documents(request: QueryRequest)   â”‚
                   â”‚  â€¢ QueryRequest(query, session_id)                 â”‚
                   â”‚  â€¢ session_manager.create_session() if needed      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ rag_system.query(
                                     â”‚   query="What is MCP?",
                                     â”‚   session_id="uuid-123"
                                     â”‚ )
                                     â–¼
                                     â”‚
                                     â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚              RAG SYSTEM ORCHESTRATOR                â”‚
                   â”‚               (rag_system.py)                      â”‚
                   â”‚                                                     â”‚
                   â”‚  1. Get conversation history â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
                   â”‚  2. Call AI generator with tools       â”‚            â”‚
                   â”‚  3. Extract sources from tool manager  â”‚            â”‚
                   â”‚  4. Update session history             â”‚            â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚                      â”‚
                                     â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         AI GENERATOR               â”‚    â”‚ SESSION MANAGER  â”‚
        â”‚        (ai_generator.py)           â”‚    â”‚                  â”‚
        â”‚                                    â”‚    â”‚ â€¢ Store chat     â”‚
        â”‚ â€¢ Build system prompt with history â”‚    â”‚   history        â”‚
        â”‚ â€¢ Call Claude API with tools       â”‚    â”‚ â€¢ Manage user    â”‚
        â”‚ â€¢ Handle tool execution if needed  â”‚    â”‚   sessions       â”‚
        â”‚ â€¢ Return final response            â”‚    â”‚ â€¢ Context window â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              ANTHROPIC CLAUDE API                           â”‚
        â”‚                                                             â”‚
        â”‚  Claude Decision Tree:                                      â”‚
        â”‚                                                             â”‚
        â”‚     "Do I need to search course materials?"                 â”‚
        â”‚                    â”‚                                        â”‚
        â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
        â”‚          â”‚                   â”‚                             â”‚
        â”‚         YES                 NO                              â”‚
        â”‚          â”‚                   â”‚                             â”‚
        â”‚          â–¼                   â–¼                             â”‚
        â”‚   Use search tool    Use general knowledge                  â”‚
        â”‚          â”‚                   â”‚                             â”‚
        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
        â”‚                    â”‚                                        â”‚
        â”‚              Generate Response                               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                   YES                 NO
                    â”‚                   â”‚
                    â–¼                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚       TOOL MANAGER          â”‚ â”‚
        â”‚    (search_tools.py)        â”‚ â”‚
        â”‚                             â”‚ â”‚
        â”‚ â€¢ Execute search tool       â”‚ â”‚
        â”‚ â€¢ Track sources for citationâ”‚ â”‚
        â”‚ â€¢ Format search results     â”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                      â”‚                 â”‚
                      â–¼                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚      VECTOR STORE           â”‚ â”‚
        â”‚    (ChromaDB Interface)     â”‚ â”‚
        â”‚                             â”‚ â”‚
        â”‚ â€¢ Semantic search           â”‚ â”‚
        â”‚ â€¢ Apply course/lesson filtersâ”‚ â”‚
        â”‚ â€¢ Return relevant chunks    â”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                      â”‚                 â”‚
                      â–¼                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚        CHROMADB             â”‚ â”‚
        â”‚    (Vector Database)        â”‚ â”‚
        â”‚                             â”‚ â”‚
        â”‚ â€¢ Store course chunks       â”‚ â”‚
        â”‚ â€¢ Embedding-based search    â”‚ â”‚
        â”‚ â€¢ Metadata filtering        â”‚ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           RESPONSE FLOW                               â”‚
â”‚                                                                       â”‚
â”‚  Search Results â”€â”€â”                                                   â”‚
â”‚      OR           â”œâ”€â”€â–¶ Claude Final Response â”€â”€â”                     â”‚
â”‚  General Knowledgeâ”€â”€â”˜                           â”‚                     â”‚
â”‚                                                 â–¼                     â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                        â”‚   RAG SYSTEM     â”‚           â”‚
â”‚                                        â”‚                  â”‚           â”‚
â”‚                                        â”‚ â€¢ Extract sources â”‚           â”‚
â”‚                                        â”‚ â€¢ Update session â”‚           â”‚
â”‚                                        â”‚ â€¢ Return response â”‚           â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                 â”‚                     â”‚
â”‚                                                 â–¼                     â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                        â”‚    FASTAPI       â”‚           â”‚
â”‚                                        â”‚                  â”‚           â”‚
â”‚                                        â”‚ â€¢ JSON response  â”‚           â”‚
â”‚                                        â”‚ â€¢ Include sources â”‚           â”‚
â”‚                                        â”‚ â€¢ Session ID     â”‚           â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                 â”‚                     â”‚
â”‚                                                 â–¼                     â”‚
â”‚                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                                        â”‚   FRONTEND       â”‚           â”‚
â”‚                                        â”‚                  â”‚           â”‚
â”‚                                        â”‚ â€¢ Remove loading â”‚           â”‚
â”‚                                        â”‚ â€¢ Display answer â”‚           â”‚
â”‚                                        â”‚ â€¢ Show sources   â”‚           â”‚
â”‚                                        â”‚ â€¢ Re-enable inputâ”‚           â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DOCUMENT PROCESSING PIPELINE (Initialization)
=============================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Course Docs   â”‚â”€â”€â”€â–¶â”‚  Document Processor  â”‚â”€â”€â”€â–¶â”‚   Text Chunks       â”‚
â”‚                 â”‚    â”‚                      â”‚    â”‚                     â”‚
â”‚ â€¢ course1.txt   â”‚    â”‚ â€¢ Parse metadata     â”‚    â”‚ â€¢ Sentence-based    â”‚
â”‚ â€¢ course2.txt   â”‚    â”‚ â€¢ Extract lessons    â”‚    â”‚ â€¢ With overlap      â”‚
â”‚ â€¢ course3.txt   â”‚    â”‚ â€¢ Chunk content      â”‚    â”‚ â€¢ Context-enriched  â”‚
â”‚ â€¢ course4.txt   â”‚    â”‚ â€¢ Add lesson context â”‚    â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                             â”‚
                                                             â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚       ChromaDB Storage      â”‚
                                              â”‚                             â”‚
                                              â”‚ â€¢ Vector embeddings         â”‚
                                              â”‚ â€¢ Course metadata           â”‚
                                              â”‚ â€¢ Searchable chunks         â”‚
                                              â”‚ â€¢ Source tracking           â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


KEY FEATURES HIGHLIGHTED
========================

ğŸ”„ SESSION MANAGEMENT: Maintains conversation context across queries
ğŸ§  INTELLIGENT TOOLS: Claude decides when to search vs use general knowledge  
ğŸ“š SEMANTIC SEARCH: Vector-based search with course/lesson filtering
ğŸ“ SOURCE TRACKING: Citations from retrieved course materials
âš¡ REAL-TIME UI: Loading states and progressive enhancement
ğŸ›¡ï¸ ERROR HANDLING: Graceful fallbacks at every layer